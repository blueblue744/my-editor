<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>CodePlay Editor</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#111827">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">
    <!-- „É©„Ç§„Éñ„É©„É™ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
      tailwind.config = {
        theme: { extend: { colors: { editor: { bg: '#1e1e1e', sidebar: '#252526', active: '#37373d', border: '#333' } } } },
      }
    </script>
    <style>
      body { margin: 0; overflow: hidden; background-color: #111827; }
      #root { height: 100vh; height: 100dvh; }
      input, textarea, button { font-family: sans-serif; }
      .modal-overlay { background-color: rgba(0,0,0,0.7); backdrop-filter: blur(2px); }
    </style>
  </head>
  <body>
    <div id="root" class="w-screen flex flex-col"></div>
    <script>
      "use strict";
      const e = React.createElement;
      const { useState, useEffect, useRef, useMemo } = React;

      // --- Icons ---
      const Icon = ({ path, size = 18, className = "" }) => e("svg", { xmlns: "http://www.w3.org/2000/svg", width: size, height: size, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", className, dangerouslySetInnerHTML: { __html: path } });
      const Icons = {
          Menu: p => e(Icon, { ...p, path: '<line x1="3" x2="21" y1="6" y2="6"/><line x1="3" x2="21" y1="12" y2="12"/><line x1="3" x2="21" y1="18" y2="18"/>' }),
          Plus: p => e(Icon, { ...p, path: '<path d="M5 12h14"/><path d="M12 5v14"/>' }),
          Trash2: p => e(Icon, { ...p, path: '<path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/>' }),
          Folder: p => e(Icon, { ...p, path: '<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>' }),
          File: p => e(Icon, { ...p, path: '<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/>' }),
          Code: p => e(Icon, { ...p, path: '<polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/>' }),
          Play: p => e(Icon, { ...p, path: '<polygon points="5 3 19 12 5 21 5 3"/>' }),
          List: p => e(Icon, { ...p, path: '<line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>' }),
          RotateCcw: p => e(Icon, { ...p, path: '<path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/>' }),
          Github: p => e(Icon, { ...p, path: '<path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/>' }),
          Flash: p => e(Icon, { ...p, path: '<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>' }),
          Upload: p => e(Icon, { ...p, path: '<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/>' }),
          Download: p => e(Icon, { ...p, path: '<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>' }),
          X: p => e(Icon, { ...p, path: '<path d="M18 6 6 18"/><path d="m6 6 12 12"/>' }),
          Archive: p => e(Icon, { ...p, path: '<rect width="20" height="5" x="2" y="3" rx="1"/><path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"/><path d="M10 12h4"/>' }),
          NewFolder: p => e(Icon, { ...p, path: '<path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" x2="12" y1="11" y2="17"/><line x1="9" x2="15" y1="14" y2="14"/>' }),
          Edit: p => e(Icon, { ...p, path: '<path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/>' }),
          ChevronDown: p => e(Icon, { ...p, path: '<polyline points="6 9 12 15 18 9"/>' }),
          ChevronRight: p => e(Icon, { ...p, path: '<polyline points="9 18 15 12 9 6"/>' }),
          SelectAll: p => e(Icon, { ...p, path: '<path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>' })
      };

      const generateId = () => Date.now().toString(36) + Math.random().toString(36).substring(2);

      // --- Components ---

      const Editor = ({ file, onChange }) => {
        const ref = useRef(null);
        useEffect(() => { if(ref.current) ref.current.scrollTop = 0; }, [file?.id]);
        
        // ‚òÖÂÖ®ÈÅ∏ÊäûÊ©üËÉΩ„ÇíËøΩÂä†
        const handleSelectAll = () => { if (ref.current) { ref.current.focus(); ref.current.select(); } };

        if (!file) return e("div", { className: "flex-1 flex flex-col items-center justify-center text-gray-500 bg-editor-bg h-full" }, e(Icons.Code, { size: 48, className: "mb-4 opacity-20" }), e("p", null, "„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû"));
        
        return e("div", { className: "flex flex-col h-full bg-editor-bg" },
          e("div", { className: "flex items-center justify-between px-4 py-2 bg-editor-sidebar border-b border-editor-border shrink-0" }, 
            e("span", { className: "text-sm text-gray-200" }, file.name),
            e("button", { onClick: handleSelectAll, className: "p-1 text-gray-500 hover:text-white rounded hover:bg-gray-700", title: "ÂÖ®ÈÅ∏Êäû" }, e(Icons.SelectAll, { size: 18 }))
          ),
          e("textarea", { ref, value: file.content, onChange: e => onChange(e.target.value), className: "flex-1 w-full bg-editor-bg text-gray-300 font-mono text-sm p-4 resize-none focus:outline-none", spellCheck: false, autoCapitalize: "off", placeholder: "// „Åì„Åì„Å´„Ç≥„Éº„Éâ„Çí„Éö„Éº„Çπ„Éà..." })
        );
      };

      const Preview = ({ files }) => {
        const [srcDoc, setSrcDoc] = useState('');
        useEffect(() => {
          try {
            const entryFile = files.find(f => ['src/main.tsx', 'src/index.tsx', 'main.tsx'].includes(f.name));
            const htmlFile = files.find(f => f.name === 'index.html');
            let html = htmlFile ? htmlFile.content : `<!DOCTYPE html><html><head><meta charset="utf-8"></head><body><div id="root"></div></body></html>`;

            // Common Libs
            const libs = `
              <script src="https://cdn.tailwindcss.com"><\/script>
              <script src="https://unpkg.com/react@18/umd/react.production.min.js"><\/script>
              <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"><\/script>
              <script src="https://unpkg.com/@babel/standalone/babel.min.js"><\/script>
            `;
            if (html.includes('<head>')) html = html.replace('<head>', `<head>${libs}`); else html = libs + html;

            // Mode 1: Vite-like Project (has src/main.tsx)
            if (entryFile) {
               const imports = { "react": "https://esm.sh/react@18.2.0", "react-dom/client": "https://esm.sh/react-dom@18.2.0/client", "react-dom": "https://esm.sh/react-dom@18.2.0" };
               const blobUrls = {};
               files.filter(f => /\.(ts|tsx|js|jsx|css)$/.test(f.name)).forEach(file => {
                  let code = file.content;
                  if (file.name.endsWith('.css')) {
                      code = `const s = new CSSStyleSheet(); s.replaceSync(\`${file.content.replace(/`/g, '\\`')}\`); export default s;`;
                  } else {
                      code = Babel.transform(file.content, { presets: ['react', 'typescript'], filename: file.name }).code;
                  }
                  const blob = new Blob([code], { type: 'application/javascript' });
                  const url = URL.createObjectURL(blob);
                  blobUrls[`./${file.name}`] = url;
                  blobUrls[`./${file.name.replace(/\.[^/.]+$/, "")}`] = url; // without extension
               });
               
               // Inject Import Map & Entry Point
               html = html.replace('</head>', `<script type="importmap">{ "imports": ${JSON.stringify({...imports, ...blobUrls})} }<\/script></head>`);
               const script = `<script type="module">
                  document.adoptedStyleSheets = [];
                  ${files.filter(f => f.name.endsWith('.css')).map((f,i) => `import s${i} from './${f.name}'; document.adoptedStyleSheets.push(s${i});`).join('\n')}
                  import './${entryFile.name}';
               <\/script>`;
               if(html.includes('</body>')) html = html.replace('</body>', `${script}</body>`); else html += script;
            
            } else {
               // Mode 2: Simple HTML/JS (Classic Mode)
               // Just inject styles and Babel for in-html scripts
               const css = files.filter(f => f.name.endsWith('.css')).map(f => f.content).join('\n');
               html = html.replace('</head>', `<style>${css}</style></head>`);
            }
            
            setSrcDoc(html);
          } catch(e) { console.error(e); setSrcDoc(`<body>Error: ${e.message}</body>`); }
        }, [files]);
        return e("iframe", { srcDoc, className: "w-full h-full bg-white", sandbox: "allow-scripts allow-modals allow-same-origin allow-forms" });
      };

      const Sidebar = ({ isOpen, onClose, projects, onSave, onLoad, onDelete, onClear, onImportJSON }) => {
        const fileInput = useRef(null);
        const handleExport = () => {
            const blob = new Blob([JSON.stringify(projects)], {type:'application/json'});
            const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = 'backup.json'; link.click();
        };
        const handleImport = (e) => {
            const r = new FileReader(); r.onload = ev => { try { onImportJSON(JSON.parse(ev.target.result)); alert('Âæ©ÂÖÉ„Åó„Åæ„Åó„Åü'); } catch(e){ alert('„Ç®„É©„Éº'); }};
            r.readAsText(e.target.files[0]); e.target.value = '';
        };
        if(!isOpen) return null;
        return e("div", { className: "fixed inset-0 z-50 flex" },
           e("div", { className: "fixed inset-0 bg-black/60", onClick: onClose }),
           e("div", { className: "relative w-80 max-w-[85%] bg-gray-900 border-r border-gray-700 flex flex-col h-full shadow-2xl" },
              e("div", { className: "p-4 border-b border-gray-800 flex justify-between items-center h-16" }, 
                 e("span", { className: "text-white font-bold flex gap-2" }, e(Icons.Folder, {className:"text-blue-500"}), "„Éó„É≠„Ç∏„Çß„ÇØ„Éà"),
                 e("button", { onClick: onClose }, e(Icons.X, {className:"text-gray-400"}))
              ),
              e("div", { className: "p-4 space-y-3 border-b border-gray-800" },
                 e("button", { onClick: onSave, className: "w-full bg-blue-600 text-white py-2 rounded font-bold" }, "ÁèæÂú®„ÅÆÁä∂ÊÖã„Çí‰øùÂ≠ò"),
                 e("div", { className: "flex gap-2" },
                    e("button", { onClick: handleExport, className: "flex-1 bg-gray-800 text-gray-300 py-2 rounded text-xs border border-gray-700 flex justify-center gap-1" }, e(Icons.Download, {size:14}), "„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó"),
                    e("button", { onClick: () => fileInput.current.click(), className: "flex-1 bg-gray-800 text-gray-300 py-2 rounded text-xs border border-gray-700 flex justify-center gap-1" }, e(Icons.Upload, {size:14}), "Âæ©ÂÖÉ"),
                    e("input", { type:"file", ref: fileInput, onChange: handleImport, className: "hidden", accept: ".json" })
                 )
              ),
              e("div", { className: "flex-1 overflow-y-auto p-2 space-y-2" },
                 projects.map(p => e("div", { key: p.id, className: "bg-gray-800 p-3 rounded flex justify-between items-center" },
                    e("div", { onClick: () => { if(confirm('Ë™≠„ÅøËæº„Åø„Åæ„Åô„ÅãÔºü')) { onLoad(p); onClose(); } }, className: "flex-1 cursor-pointer" },
                        e("div", { className: "text-sm font-bold text-gray-200" }, p.name),
                        e("div", { className: "text-xs text-gray-500" }, new Date(p.createdAt).toLocaleDateString())
                    ),
                    e("button", { onClick: () => onDelete(p.id), className: "text-gray-500 hover:text-red-400 p-2" }, e(Icons.Trash2, {size:16}))
                 ))
              ),
              e("div", { className: "p-4 border-t border-gray-800" }, e("button", { onClick: onClear, className: "w-full text-red-500 text-xs py-2 border border-red-900/30 rounded" }, "ÂÖ®„Éá„Éº„ÇøÊ∂àÂéª"))
           )
        );
      };

      const FileExplorer = ({ files, activeFileId, onSelect, onAdd, onDelete, onUpload, onRenameFile, onRenameFolder, onDeleteFolder, onGitHub, onGenerateConfig }) => {
        const [name, setName] = useState('');
        const [isAdding, setIsAdding] = useState(false);
        const fileInputRef = useRef(null);
        const fileTree = useMemo(() => {
            const root = { name: "root", isFolder: true, children: {} };
            files.forEach(f => {
                let curr = root;
                f.name.split('/').forEach((part, i, arr) => {
                    if (i === arr.length - 1) curr.children[part] = { ...f, isFolder: false, path: f.name };
                    else { if(!curr.children[part]) curr.children[part] = { name: part, isFolder: true, children: {}, path: arr.slice(0,i+1).join('/') }; curr = curr.children[part]; }
                });
            });
            return root;
        }, [files]);

        const FileNode = ({ node, depth=0 }) => {
            const [open, setOpen] = useState(true);
            if (!node.isFolder) return e("div", { onClick: () => onSelect(node.id), className: `flex justify-between items-center py-1 pr-2 cursor-pointer text-sm hover:bg-gray-800 ${activeFileId === node.id ? 'text-white bg-gray-700' : 'text-gray-400'}`, style: { paddingLeft: depth*12+12 } },
                e("div", { className: "flex items-center gap-1 overflow-hidden" }, e(Icons.File, { size: 14 }), e("span", { className: "truncate" }, node.name.split('/').pop())),
                e("div", { className: "flex gap-1" },
                    e("button", { onClick: ev => { ev.stopPropagation(); onRenameFile(node); } }, e(Icons.Edit, { size: 12 })),
                    e("button", { onClick: ev => { ev.stopPropagation(); if(confirm('ÂâäÈô§?')) onDelete(node.id); } }, e(Icons.Trash2, { size: 12 }))
                )
            );
            const children = Object.values(node.children).sort((a,b) => a.isFolder===b.isFolder ? a.name.localeCompare(b.name) : a.isFolder ? -1 : 1);
            return e(React.Fragment, null,
                e("div", { onClick: () => setOpen(!open), className: "flex justify-between items-center py-1 pr-2 cursor-pointer text-sm text-gray-300 hover:bg-gray-800", style: { paddingLeft: depth*12+6 } },
                    e("div", { className: "flex items-center gap-1" }, e(open ? Icons.ChevronDown : Icons.ChevronRight, { size: 14 }), e(Icons.Folder, { size: 14, className: "text-blue-400" }), e("span", null, node.name)),
                    e("div", { className: "flex gap-1" },
                        e("button", { onClick: ev => { ev.stopPropagation(); onRenameFolder(node.path, node.name); } }, e(Icons.Edit, { size: 12 })),
                        e("button", { onClick: ev => { ev.stopPropagation(); if(confirm('ÂâäÈô§?')) onDeleteFolder(node.path); } }, e(Icons.Trash2, { size: 12 }))
                    )
                ),
                open && children.map(c => e(FileNode, { key: c.path || c.id, node: c, depth: depth+1 }))
            );
        };

        return e("div", { className: "flex flex-col h-full bg-editor-sidebar border-r border-editor-border" },
           e("div", { className: "p-2 border-b border-editor-border flex flex-col gap-2" },
              e("div", { className: "flex justify-between" },
                 e("span", { className: "text-xs font-bold text-gray-400" }, "EXPLORER"),
                 e("div", { className: "flex gap-1" },
                    e("button", { onClick: onGitHub, title: "GitHub" }, e(Icons.Github, {size:16, className:"text-gray-400 hover:text-white"})),
                    e("button", { onClick: onGenerateConfig, title: "CF Config" }, e(Icons.Flash, {size:16, className:"text-yellow-500 hover:text-white"})),
                    e("button", { onClick: () => setIsAdding(!isAdding), title: "Add" }, e(Icons.Plus, {size:16, className:"text-gray-400 hover:text-white"}))
                 )
              ),
              isAdding && e("form", { onSubmit: e => { e.preventDefault(); if(name) { onAdd(name, 'text', ''); setName(''); setIsAdding(false); } } },
                 e("input", { value: name, onChange: e => setName(e.target.value), className: "w-full bg-gray-900 text-white text-sm p-1 rounded border border-gray-700", placeholder: "Filename", autoFocus: true, onBlur: () => setTimeout(()=>setIsAdding(false), 200) })
              )
           ),
           e("div", { className: "flex-1 overflow-y-auto" }, files.length===0 ? e("div",{className:"p-4 text-xs text-center text-gray-600"},"No Files") : e(FileNode, { node: fileTree }))
        );
      };

      const GitHubModal = ({ isOpen, onClose, files }) => {
         const [token, setToken] = useState(() => localStorage.getItem('cp_gh_token') || '');
         const [repo, setRepo] = useState(() => localStorage.getItem('cp_gh_repo') || '');
         const [status, setStatus] = useState('');
         const [isUploading, setIsUploading] = useState(false);
         const handlePush = async () => {
             if(!token || !repo) return alert('Token & Repo required');
             localStorage.setItem('cp_gh_token', token); localStorage.setItem('cp_gh_repo', repo);
             setIsUploading(true); setStatus('Starting...');
             try {
                const headers = { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' };
                const repoUrl = `https://api.github.com/repos/${repo}`;
                if(!(await fetch(repoUrl, { headers })).ok) throw new Error('Repo not found');
                for (const file of files.filter(f => !f.name.endsWith('.keep'))) {
                    setStatus(`Pushing ${file.name}...`);
                    const content = btoa(unescape(encodeURIComponent(file.content)));
                    const url = `${repoUrl}/contents/${file.name}`;
                    let sha = null;
                    try { const r = await fetch(`${url}?ref=main`, { headers }); if(r.ok) sha = (await r.json()).sha; } catch(e){}
                    const body = { message: `Update ${file.name}`, content, branch: 'main', ...(sha && { sha }) };
                    await fetch(url, { method: 'PUT', headers: {...headers, 'Content-Type': 'application/json'}, body: JSON.stringify(body) });
                }
                setStatus('Done!');
             } catch(e) { setStatus('Error: ' + e.message); } finally { setIsUploading(false); }
         };
         if(!isOpen) return null;
         return e("div", { className: "fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4" },
             e("div", { className: "bg-gray-900 border border-gray-700 rounded w-full max-w-sm p-4 text-white" },
                 e("h3", { className: "font-bold mb-2" }, "GitHub Push"),
                 e("input", { type: "password", value: token, onChange: e=>setToken(e.target.value), placeholder: "Token", className: "w-full bg-gray-800 mb-2 p-2 rounded" }),
                 e("input", { value: repo, onChange: e=>setRepo(e.target.value), placeholder: "User/Repo", className: "w-full bg-gray-800 mb-2 p-2 rounded" }),
                 e("div", { className: "text-xs text-green-400 mb-2" }, status),
                 e("div", { className: "flex justify-end gap-2" },
                     e("button", { onClick: onClose, className: "text-gray-400" }, "Close"),
                     e("button", { onClick: handlePush, disabled: isUploading, className: "bg-green-600 px-3 py-1 rounded" }, isUploading ? "..." : "Push")
                 )
             )
         );
      };

      const App = () => {
        const [files, setFiles] = useState([]);
        const [projects, setProjects] = useState(() => { try { return JSON.parse(localStorage.getItem('cp_projects')||'[]'); } catch { return []; } });
        const [activeId, setActiveId] = useState(null);
        const [sidebarOpen, setSidebarOpen] = useState(false);
        const [mobileTab, setMobileTab] = useState('files');
        const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
        const [showGithub, setShowGithub] = useState(false);

        useEffect(() => localStorage.setItem('cp_projects', JSON.stringify(projects)), [projects]);
        useEffect(() => { const h = () => setIsMobile(window.innerWidth < 768); window.addEventListener('resize', h); return () => window.removeEventListener('resize', h); }, []);

        // „Éó„É≠„Ç∏„Çß„ÇØ„Éà‰øùÂ≠ò„ÉªË™≠Ëæº
        const handleSave = () => {
            const name = prompt("„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÂêç:"); if(!name) return;
            const newProj = { id: generateId(), name, files, createdAt: Date.now() };
            setProjects(prev => [newProj, ...prev]);
        };
        const handleLoad = (p) => { setFiles(p.files); setActiveId(p.files[0]?.id); };
        
        // „Éï„Ç°„Ç§„É´Êìç‰Ωú
        const handleAdd = (name, lang='text', content='') => setFiles([...files, { id: generateId(), name, language: lang, content }]);
        const handleRenameFile = (node) => { const n = prompt("New name:", node.name); if(n) setFiles(files.map(f => f.id===node.id ? {...f, name: n} : f)); };
        const handleRenameFolder = (oldP, newN) => { const n = prompt("New name:", newN); if(n) { const pre = oldP+"/", parent=oldP.split('/').slice(0,-1).join('/'), next = parent ? `${parent}/${n}` : n; setFiles(files.map(f => f.name.startsWith(pre) ? {...f, name: f.name.replace(oldP, next)} : f)); }};
        const handleDeleteFolder = (path) => setFiles(files.filter(f => !f.name.startsWith(path+"/")));
        const handleGenerateConfig = () => {
            if(!confirm('CloudflareÁî®Ë®≠ÂÆö„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÅãÔºü(‰∏äÊõ∏„ÅçÊ≥®ÊÑè)')) return;
            const t = [
                {name:"package.json", content:JSON.stringify({name:"app",version:"0.0.0",type:"module",scripts:{dev:"vite",build:"npm i && tsc && vite build"},dependencies:{react:"^18.2.0","react-dom":"^18.2.0"},devDependencies:{"@vitejs/plugin-react":"^4.0.0",vite:"^4.0.0",typescript:"^5.0.0",tailwindcss:"^3.0.0"}},null,2)},
                {name:"vite.config.ts", content:`import {defineConfig} from 'vite'; import react from '@vitejs/plugin-react'; export default defineConfig({plugins:[react()]});`},
                {name:"index.html", content:`<!DOCTYPE html><html><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width"/><title>App</title><script src="https://cdn.tailwindcss.com"><\/script></head><body><div id="root"></div><script type="module" src="/src/main.tsx"><\/script></body></html>`},
                {name:"src/main.tsx", content:`import React from 'react'; import ReactDOM from 'react-dom/client'; import App from './App'; ReactDOM.createRoot(document.getElementById('root')).render(<App/>);`},
                {name:"src/App.tsx", content:`export default function App(){ return <div className="p-10 text-3xl font-bold text-blue-500">Hello Cloudflare!</div>; }`}
            ];
            const newF = t.map(x => ({id:generateId(), ...x}));
            setFiles(newF); setActiveId(newF.find(f=>f.name==='src/App.tsx').id);
        };

        const activeFile = files.find(f => f.id === activeId);

        return e("div", { className: "flex flex-col h-full text-white font-sans bg-gray-900" },
           e("header", { className: "bg-editor-sidebar border-b border-editor-border p-1 flex items-center justify-between shrink-0 h-16" },
              e("div", { className: "flex items-center gap-2 pl-2" },
                 e("button", { onClick: () => setSidebarOpen(true), className: "p-2 hover:bg-gray-700 rounded" }, e(Icons.Menu, {size:20})),
                 e("span", { className: "font-bold" }, "CodePlay")
              ),
              e("div", { className: "flex items-center gap-1 pr-1" },
                 e("button", { onClick: () => { if(confirm('„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü')) setFiles([]); }, className: "p-2 hover:bg-gray-700 rounded" }, e(Icons.RotateCcw, {size:18}))
              )
           ),
           e("main", { className: "flex-1 flex overflow-hidden relative" },
              e("div", { className: `${(isMobile && mobileTab!=='files') ? 'hidden' : 'flex'} w-full md:w-64 md:flex-none flex-col h-full z-10 border-r border-editor-border bg-editor-sidebar` },
                 e(FileExplorer, { files, activeFileId, onSelect: id=>{setActiveId(id); if(isMobile) setMobileTab('editor');}, onAdd: handleAdd, onDelete: id=>setFiles(files.filter(f=>f.id!==id)), onRenameFile: handleRenameFile, onRenameFolder: handleRenameFolder, onDeleteFolder: handleDeleteFolder, onGitHub: ()=>setShowGithub(true), onGenerateConfig: handleGenerateConfig })
              ),
              e("div", { className: `${(isMobile && mobileTab!=='editor') ? 'hidden' : 'flex'} flex-1 flex-col min-w-0 md:border-r border-editor-border` },
                 e(Editor, { file: activeFile, onChange: val => setFiles(files.map(f => f.id===activeId ? {...f, content: val} : f)) })
              ),
              e("div", { className: `${(isMobile && mobileTab!=='preview') ? 'hidden' : 'flex'} flex-1 flex-col bg-white h-full` }, e(Preview, { files }))
           ),
           e("div", { className: "md:hidden h-16 bg-editor-sidebar border-t border-editor-border flex items-center justify-around shrink-0" },
              e("button", { onClick: ()=>setMobileTab('files'), className: `flex flex-col items-center justify-center w-full h-full ${mobileTab==='files'?'text-blue-400':'text-gray-500'}` }, e(Icons.List, {size:20}), e("span",{className:"text-[10px]"},"Files")),
              e("button", { onClick: ()=>setMobileTab('editor'), className: `flex flex-col items-center justify-center w-full h-full ${mobileTab==='editor'?'text-blue-400':'text-gray-500'}` }, e(Icons.Code, {size:20}), e("span",{className:"text-[10px]"},"Editor")),
              e("button", { onClick: ()=>setMobileTab('preview'), className: `flex flex-col items-center justify-center w-full h-full ${mobileTab==='preview'?'text-blue-400':'text-gray-500'}` }, e(Icons.Play, {size:20}), e("span",{className:"text-[10px]"},"Run"))
           ),
           e(GitHubModal, { isOpen: showGithub, onClose: ()=>setShowGithub(false), files }),
           e(Sidebar, { isOpen: sidebarOpen, onClose: ()=>setSidebarOpen(false), projects, onSave: handleSave, onLoad: handleLoad, onDelete: id=>setProjects(projects.filter(p=>p.id!==id)), onClear: ()=>setProjects([]), onImportJSON: json=>setProjects([...json, ...projects]) })
        );
      };

      ReactDOM.createRoot(document.getElementById('root')).render(e(App));
    </script>
  </body>
</html>
