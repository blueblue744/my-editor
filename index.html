<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iPhone React Playground</title>
    <!-- ReactとBabelを読み込み -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS (デザイン用) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html { height: 100%; margin: 0; overflow: hidden; background: #1e1e1e; color: #fff; font-family: monospace; }
        #container { display: flex; flex-direction: column; height: 100%; }
        #preview { flex: 1; background: #fff; color: #000; overflow: auto; border-bottom: 2px solid #333; position: relative; }
        #editor-area { flex: 1; display: flex; flex-direction: column; min-height: 40%; }
        textarea { flex: 1; background: #1e1e1e; color: #d4d4d4; border: none; padding: 10px; font-size: 14px; resize: none; outline: none; }
        #toolbar { background: #333; padding: 8px; display: flex; justify-content: space-between; align-items: center; }
        button { background: #007acc; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 14px; cursor: pointer; }
        #error-msg { color: red; padding: 10px; background: #fee; display: none; }
    </style>
</head>
<body>
    <div id="container">
        <!-- プレビュー画面 (ここにあぷりが表示されます) -->
        <div id="preview">
            <div id="root"></div>
            <div id="error-msg"></div>
        </div>

        <!-- ツールバー -->
        <div id="toolbar">
            <span>React Code Editor</span>
            <button onclick="runCode()">▶ Run (実行)</button>
        </div>

        <!-- コード入力エリア -->
        <div id="editor-area">
            <textarea id="code-input" spellcheck="false">
const { useState } = React;

function App() {
  const [count, setCount] = useState(0);
  return (
    <div className="p-10 text-center">
      <h1 className="text-3xl font-bold text-blue-600 mb-4">
        Hello iPhone!
      </h1>
      <p className="mb-4">コードをコピペして「実行」を押してね</p>
      <button 
        className="bg-blue-500 text-white px-4 py-2 rounded"
        onClick={() => setCount(c => c + 1)}
      >
        Count is: {count}
      </button>
    </div>
  );
}

// 描画
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
            </textarea>
        </div>
    </div>

    <script>
        function runCode() {
            const code = document.getElementById('code-input').value;
            const errorMsg = document.getElementById('error-msg');
            const rootEl = document.getElementById('root');
            
            errorMsg.style.display = 'none';
            
            // Reactのルートを一度リセット（簡易的な方法）
            rootEl.innerHTML = ''; 
            
            try {
                // BabelでJSXをブラウザ用JSに変換
                const transpiled = Babel.transform(code, { 
                    presets: ['react', 'es2015'] 
                }).code;
                
                // 実行
                // ReactDOM.createRootは再実行時に既存のルートがあると警告が出るため
                // 簡易エディタ用に都度評価する仕組みにしています
                const func = new Function('React', 'ReactDOM', transpiled);
                func(React, ReactDOM);
                
            } catch (err) {
                console.error(err);
                errorMsg.innerText = err.toString();
                errorMsg.style.display = 'block';
            }
        }
        
        // 初回実行
        window.onload = runCode;
    </script>
</body>
</html>
